<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container mt-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Student List</h4>

        <div class="d-flex gap-2">
            <!-- Cart Button -->
            <a href="{% url 'cart_detail' %}" class="btn btn-outline-dark">
                Cart 
            </a>

            <a href="{% url 'student_create' %}" class="btn btn-success">
                + Add Student
            </a>
        </div>
    </div>

    <!-- Search + Sort Form -->
    <form method="get" class="row g-2 mb-3">

        <!-- Search -->
        <div class="col-md-4">
            <input
                type="text"
                name="q"
                class="form-control"
                placeholder="Search by name or city"
                value="{{ request.GET.q }}"
            >
        </div>

        <!-- Sort Field -->
        <div class="col-md-3">
            <select name="sort" class="form-select">
                <option value="">Sort By</option>
                <option value="name" {% if request.GET.sort == "name" %}selected{% endif %}>
                    Name
                </option>
                <option value="city" {% if request.GET.sort == "city" %}selected{% endif %}>
                    City
                </option>
            </select>
        </div>

        <!-- Order -->
        <div class="col-md-3">
            <select name="order" class="form-select">
                <option value="asc" {% if request.GET.order == "asc" %}selected{% endif %}>
                    Ascending
                </option>
                <option value="desc" {% if request.GET.order == "desc" %}selected{% endif %}>
                    Descending
                </option>
            </select>
        </div>

        <!-- Actions -->
        <div class="col-md-2 d-flex gap-2">
            <button type="submit" class="btn btn-primary w-100">
                Apply
            </button>
            <a href="{% url 'student_list' %}" class="btn btn-secondary w-100">
                Reset
            </a>
        </div>

    </form>

    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    {% endif %}

    <!-- Cards -->
    <div class="row g-4">

        {% for student in students %}
        <div class="col-md-4">

            <div class="card h-100 shadow-sm">

                <!-- Image -->
                <img src="{{ student.image.url }}"
                     class="card-img-top"
                     style="height:200px; object-fit:cover;"
                     alt="{{ student.name }}">

                <div class="card-body">
                    <h5 class="card-title">{{ student.name }}</h5>
                    <p class="text-muted mb-2">
                        City: {{ student.city }}
                    </p>

                    <a href="{{ student.documents.url }}"
                       target="_blank"
                       class="btn btn-sm btn-outline-primary">
                        View Doc
                    </a>
                    <a href="{{ student.documents.url }}"
                       download
                       class="btn btn-sm btn-outline-secondary">
                        Download
                    </a>
                </div>

                <!-- Actions -->
                <div class="card-footer d-flex justify-content-between gap-2">

                    <a href="{% url 'student_update' student.id %}"
                       class="btn btn-sm btn-warning">
                        Edit
                    </a>

                    <a href="{% url 'student_delete' student.id %}"
                       class="btn btn-sm btn-danger"
                       onclick="return confirm('Are you sure?');">
                        Delete
                    </a>

                    <!-- Add to Cart (SESSION LIST) -->
                    <a href="{% url 'cart_add' student.id %}"
                       class="btn btn-sm btn-success">
                        Add to Cart
                    </a>

                </div>

            </div>

        </div>
        {% empty %}
            <p class="text-muted text-center">No students found</p>
        {% endfor %}

    </div>


    <!-- <table class="table table-bordered table-hover align-middle text-center">
        <thead class="table-dark">
            <tr>
                <th>Name</th>
                <th>City</th>
                <th>Image</th>
                <th>Document</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for student in students %}
            <tr>
                <td>{{ student.name }}</td>
                <td>{{ student.city }}</td>

                <td>
                    <img src="{{ student.image.url }}" class="img-thumbnail" width="80">
                </td>

                <td>
                    <a href="{{ student.documents.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                        View
                    </a>
                    <a href="{{ student.documents.url }}" download class="btn btn-sm btn-outline-secondary">
                        Download
                    </a>
                </td>

                <td>
                    <a href="{% url 'student_update' student.id %}" class="btn btn-sm btn-warning">
                        Edit
                    </a>
                    <a href="{% url 'student_delete' student.id %}" class="btn btn-sm btn-danger"
                        onclick="return confirm('Are you sure you want to delete this student?');">
                        Delete
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-muted">No students found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table> -->

</div>
